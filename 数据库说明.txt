-- 用户表
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT '客户ID',
    username VARCHAR(50) UNIQUE NOT NULL COMMENT '客户名',
    password VARCHAR(50) NOT NULL COMMENT '登录密码',
    phone VARCHAR(20) COMMENT '联系电话',
    address VARCHAR(200) DEFAULT '未填写' COMMENT '地址',
    balance DECIMAL(10,2) DEFAULT 0.00 COMMENT '账户余额',
    remark TEXT COMMENT '备注',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    modified_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间'
) COMMENT '用户表';

-- 商品表
CREATE TABLE commodities (
   id INT PRIMARY KEY AUTO_INCREMENT COMMENT '商品ID',
   name VARCHAR(100) NOT NULL COMMENT '商品名称',
   type VARCHAR(50) COMMENT '商品类别',
   detail TEXT COMMENT '商品详情',
   production_date DATE COMMENT '生产日期',
   manufacturer VARCHAR(100) COMMENT '生产商',
   origin VARCHAR(100) COMMENT '产地',
   remark TEXT COMMENT '备注'
) COMMENT '商品表';

-- 商品SKU表
CREATE TABLE skus (
    skuid INT PRIMARY KEY AUTO_INCREMENT COMMENT 'SKU ID',
    commodityid INT NOT NULL COMMENT '商品ID',
    color VARCHAR(50) DEFAULT '默认颜色' COMMENT '颜色',
    style VARCHAR(50) DEFAULT '默认款式' COMMENT '款式',
    price DECIMAL(10,2) NOT NULL COMMENT '单价',
    stock INT NOT NULL DEFAULT 0 COMMENT '库存',
    CONSTRAINT fk_commodity FOREIGN KEY (commodityid) 
        REFERENCES commodities(id)
        ON DELETE CASCADE
        ON UPDATE CASCADE
) COMMENT '商品SKU表';

-- 订单表
CREATE TABLE orders (
    orderid INT PRIMARY KEY AUTO_INCREMENT COMMENT '订单ID',
    userid INT NOT NULL COMMENT '客户ID',
    skuid INT NOT NULL COMMENT '商品SKUID',
    quantity INT NOT NULL CHECK (quantity > 0) COMMENT '数量',
    price DECIMAL(10,2) NOT NULL COMMENT '下单时单价',
    total_amount DECIMAL(10,2) NOT NULL COMMENT '订单总金额',
    status ENUM('待支付', '已支付', '已发货', '已完成', '已取消') NOT NULL DEFAULT '待支付' COMMENT '订单状态',
    shipping_address VARCHAR(200) NOT NULL COMMENT '收货地址',
    payment_method VARCHAR(50) COMMENT '支付方式',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '下单时间',
    payment_time DATETIME COMMENT '支付时间',
    shipped_time DATETIME COMMENT '发货时间',
    completed_time DATETIME COMMENT '完成时间',
    remark TEXT COMMENT '备注',
    FOREIGN KEY (userid) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (skuid) REFERENCES skus(skuid) ON DELETE RESTRICT
) COMMENT '订单表';

-- 购物车表
CREATE TABLE cart (
    cartid INT PRIMARY KEY AUTO_INCREMENT COMMENT '购物车ID',
    userid INT NOT NULL COMMENT '客户ID',
    skuid INT NOT NULL COMMENT '商品SKUID',
    num INT NOT NULL COMMENT '数量',
    FOREIGN KEY (userid) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (skuid) REFERENCES skus(skuid)
) COMMENT '购物车表';